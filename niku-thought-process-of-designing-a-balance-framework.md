<!DOCTYPE html>
<!-- saved from url=(0032)http://127.0.0.1:51004/view/3409 -->
<html>
  <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <div class="container">
      <div id="markup">
        <article id="content" class="markdown-body">

<p>from: https://medium.com/@saltyaom/niku-thought-process-of-designing-a-balance-framework-1d9218fcdabd</p>

<p>title: Niku: Thought Process of Designing a Balance Framework</p>

<section><div><div class="gl as ib ic id ie"></div><div class="if ig ih ii ij"><div class=""><h1 id="d4f4" class="pw-post-title ik il im bn in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji gn" data-selectable-paragraph="">Niku: Thought Process of Designing a Balance Framework</h1></div><figure class="fw fy jk jl jm jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft jj"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_VpCooRlu5SxcRmBhjNEnjA.jpeg" width="700" height="394" role="presentation"></div></div></figure><p id="ea64" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Since the beginning of Software development, “Developer Experience” has been discussed all the time.</p><p id="78d1" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Over years, they learn from their pain point, trying to solve and improve the pain point of their approach to coding.</p><p id="130e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Object-Oriented Programming, Functional Programming, Declarative Programming.</p><p id="ce72" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">These approaches and design paradigms usually have many different benefits but all share the same goal.</p><p id="df9a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It's the same reason why we move from hand-tuned assembly to high-level programming language.</p><blockquote class="ks"><p id="b3f4" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">They make programming easier</p></blockquote><h1 id="b50a" class="lc ld im bn le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz gn" data-selectable-paragraph="">It’s not happening over a night</h1><p id="9d8d" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">But as technology has influenced the world, we can’t afford to rewrite everything from scratch and convince the users to install a new version of the thing we wrote and its dependencies.</p><p id="7e25" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Take the web for an example, it has been stuck with JavaScript, a language that was written in 10 days, and it’s not quite good.</p><p id="90fd" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">There is 2 choice we can solve the problem.</p><ol class=""><li id="cd2d" class="mf mg im jw b jx jy kb kc kf mh kj mi kn mj kr mk ml mm mn gn" data-selectable-paragraph="">Convince every browser to create a new language, deprecate JavaScript, convince every developer to migrate their codebase to the new written language then convince everyone to update their browser to the new version.</li><li id="81b9" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">Stick with JavaScript and try to improve it.</li></ol><p id="33d7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">We choose the second one because it’s what could happen in a matter of days,<br>And most developers would likely not going to refactor their entire codebase to this new, well-designed language if it doesn’t work with their current codebase.</p><p id="c830" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">That’s why we don’t see new any new language used in frontend web development (excluding Web Assembly which still requires JavaScript).</p><p id="c281" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">When something is created, it’s stuck with that environment although some might migrate to a better solution, it will be gradually adopted and not happen over a night.</p><p id="9ef6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It requires a lot of hard work and time to fully migrate from one to another.</p><h1 id="999e" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">To live with what we have</h1><p id="de6c" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">Even if you’re trying to gradually migrate away from your current environment, you’ll still require to work with it, or at least edit or refactor some part.</p><p id="d393" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You are stuck with that environment you’re working in, that’s when the library, and framework can help you.</p><p id="e0f0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">These tools are like a programming language, it helps you solve one thing and another while benefiting you with something but mostly trying to improve your developer experience.</p><p id="5f77" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Browsers used to have their own way to control the web and differs from each other, resulting in one code to works in some and not working in others.</p><p id="dd93" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">However, in 2006, a library name “jQuery” was released.<br>It’s a library that helps developers use the same code to work on every major browser and not only that, it makes coding easier removing boilerplates, and handling redundant things so developers could develop web easier.</p><p id="d069" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Later, many concepts from jQuery were migrated to browser API itself, and thus union all the browser API to be the same. But it takes a very long time until then.</p><p id="9e6b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">At the time, you couldn’t wait for the others to make API work across browsers, you have to live with what you had.</p><p id="a121" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">That’s why jQuery was created.</p><h1 id="3f55" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Same problem, different approaches</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft mw"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_6Qd6tx0cbpeB-BgyFOp6Qw.jpeg" width="700" height="394" role="presentation"></div></div><figcaption class="nb bm fu fs ft nc nd bn b bo bp co" data-selectable-paragraph="">Millennium Gamepad</figcaption></figure><p id="5ec7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Do you know a gamepad?<br>It’s a good tool for us to enjoy our games.</p><p id="ca2d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">There were many tools back then you could play a game, like Nintendo Power Glove, NES Duck Hunt, even keyboard and mouse.</p><p id="e31d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But do recognize that those different designs all share a simple goal?</p><blockquote class="ks"><p id="2a29" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">How could we make our player have fun playing game.</p></blockquote><p id="8605" class="pw-post-body-paragraph ju jv im jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr if gn" data-selectable-paragraph="">After the years, the gamepad survives and becomes the primary control of the console game.</p><p id="98f9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It survives not because it’s as good as Duck Hunt when you’re playing a shooting game, or as looks cool as Nintendo Power Glove.</p><p id="a9ee" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But because it has a great design decision.<br>Universal, and easy to use, and people like it.</p></div><div class="o dz nj nk hr nl" role="separator"><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no"></span></div><div class="if ig ih ii ij"><p id="21cc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">In web development, there are many popular frameworks trying to make web development easier.</p><p id="589a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But we didn’t pick this framework because it has many stars on Github or has many questions on Stackoverflow.</p><p id="d5ee" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">We adopt a library and framework not because it offers, that’s only an effect.<br>But because of the design decisions made creating these frameworks.</p><p id="edb0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">If the design decision was right, no matter what features you will need, you will eventually get it somehow.</p><p id="945c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Evan You, the creator of Vuejs once said at JSConf Asia.</p><blockquote class="ks"><p id="60f8" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">What you should probably care more about is about internal technical decision, what actually defers these framework.</p></blockquote><h1 id="42af" class="lc ld im bn le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz gn" data-selectable-paragraph="">People don’t know what they really want</h1><p id="6e35" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">If you are walking down the street, try randomly asking someone what they’re missing from their life and how could they make it better.</p><p id="d3b6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">They don’t know.</p><p id="90b2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Many people don’t know they want a smartphone before Steve Jobs introduced an iPhone.</p><p id="90d6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">To answer this question, Steve Jobs tried to ask people the same problem above, what they’re missing from their life, but no one really knows what they’re missing.</p><p id="8091" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Steve carefully observe the pattern and found that people carry a lot of things to go to work and he combined all of that into a single product.</p><p id="e43a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">That design decision is what makes an iPhone a great product at the time.</p><p id="624a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But do you know that before an iPhone was created, there was almost a similar device named “Newton”.</p><p id="8df2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">To put it briefly, it’s like an iPhone but uses a stylus as a primary input method.</p><p id="4d56" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Well, it failed.<br>That’s why Steve Jobs said at the introduction of an iPhone that “nobody wants a stylus”.</p><p id="3785" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Although, it is quite similar to the iPhone the reason that it fails isn’t that it has a stylus but rather its design decision.</p><p id="4f38" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It doesn’t solve any problems as an iPhone does.<br>Well the “nobody wants a stylus” is a part of it.</p><h1 id="d651" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Declarative Complexity</h1><p id="8969" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">Declarative programming sounds good.</p><p id="a367" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s like instead of telling how to go from your home to the mall by saying the taxi driver left or right every corner, you tell the taxi driver to just go to the mall, and that’s it.</p><p id="8f58" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">In programming, it isn’t easy to create a framework to be declarative.<br>It requires thoughtful decisions on every corner, because</p><blockquote class="ks"><p id="27b0" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">“Anything that can go wrong will go wrong.”</p></blockquote><p id="e5b7" class="pw-post-body-paragraph ju jv im jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr if gn" data-selectable-paragraph="">Even a simple library but making it declarative is hard.</p><p id="1e8c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Especially when you’re creating a declarative programming language Framework for creating a Cross-Platform app is hard.</p><p id="339e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">That’s what Flutter is doing.<br>It has to handle every edge case.</p><p id="195e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You can build UI in Flutter declaratively.</p><p id="e698" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But because it has to be declarative, Flutter has to handle every edge case instead of developers, and because of possibility in programming is infinite, even creating UI with a design system is still complex.</p><p id="b244" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Because of its complexity, developers have to handle that possibility.<br>That’s why Flutter is verbose.</p><p id="2943" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Declarative library and framework usually go into the pitfall of what I call <strong class="jw in">“Declarative Complexity”, </strong>which makes the codes too verbose and makes imperative programming somehow has better Developer Experience than Declarative.</p><p id="23f8" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s controversial for Declarative Programming to have worse “Developer Experience” than imperative programming, it defeats its purpose of becoming declarative in the first place.</p><p id="9b97" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But how verbose is too verbose?</p><p id="9327" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Take this code as an example and tell me it’s doing:</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft nq"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_KZBl-Tq3CGBhgfAURVWXDg.png" width="700" height="594" role="presentation"></div></div></figure><p id="14c1" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">As you might have guessed, it creates a text with a red background when the width is less than 568px or it’ll be blue.</p><p id="9400" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Criteria for each person are different but for me, when I have to think about what the code is doing, I considered it’s too verbose.</p><p id="0cbb" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This is one common component that you will most likely have in your codebase, creating an app with Flutter.</p><p id="a202" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And well, I’m certainly not happy to write this code over and over again.</p><p id="a3ac" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So I’ll try to find a way to make it better.</p><h1 id="ce9d" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Imperative of Declarative</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft jj"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_Ys6pLZihNdyVhAoiPC9C3w.jpeg" width="700" height="394" role="presentation"></div></div><figcaption class="nb bm fu fs ft nc nd bn b bo bp co" data-selectable-paragraph="">Hina, cute and funny</figcaption></figure><p id="9ff0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But have can we improve this code?</p><p id="1201" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I think about it for quite a long time, even seeking out how other framework and language is doing but I found something quite interesting.</p><ul class=""><li id="900d" class="mf mg im jw b jx jy kb kc kf mh kj mi kn mj kr nr ml mm mn gn" data-selectable-paragraph="">React Native offers you to separate structure declaration from styling by using StyleSheet.</li><li id="9bc3" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr nr ml mm mn gn" data-selectable-paragraph="">SwiftUI offers you a way to style components by using modifier property (chaining method)</li></ul><p id="b817" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">These two are the complete opposite of what Flutter is trying to do.</p><p id="888e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn ns" data-selectable-paragraph=""><span class="l nt nu nv nw nx ny nz oa ob dq">1</span>In Flutter, everything is a widget, you use Widget to build a UI.<br>Well, when everything is a Widget, that means a UI representative like a Text, Button, Dropdown is also constructed as the same as what you can’t see like ValueListener, GestureDetector, FutureBuilder.</p><p id="810d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It doesn't decouple the UI representation from Business Logic, instead, the Flutter approach tied it together and merge it together making it more verbose than separable logic, making it too nested than it should be.</p><p id="50b3" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn ns" data-selectable-paragraph=""><span class="l nt nu nv nw nx ny nz oa ob dq">2</span>Abstraction in Flutter is hard.<br>You see, Flutter and Dart are Object-Oriented Programmings which means Abstraction, Inheritance is one of its main strengths, you should be able to create an abstraction over a class easily.</p><p id="859b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">However, creating an abstraction of an old widget is not quite as traditional as OOP.</p><p id="a451" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Take <strong class="jw in">“TextFormField”</strong> as an example.</p><p id="8b66" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">TextFormField is a class that extends “TextField” which when constructed, will directly “UnmanagedRestorationScope” which also store “TextField” and drop all of its property accepted by the constructor.</p><p id="e9d7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This means, when you construct a TextFormField, you are unable to get its property back or at least a very hard thing to do in not a test environment.</p><p id="0f1d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This will be a problem when you don’t know what the widget is holding but require its property to create a new one based on its value.<br>Presumably, usually occurs when you’re using a library and want to change its behavior.</p><p id="9691" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You just can’t fully create an abstraction, inherits or polymorphism over the widget, or can but is limited.</p><p id="3c79" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">From the problems above, I draft a requirement of a way of writing Flutter for my happiness for myself.</p><ol class=""><li id="ed0e" class="mf mg im jw b jx jy kb kc kf mh kj mi kn mj kr mk ml mm mn gn" data-selectable-paragraph="">It should be recognizable at the first glance</li><li id="c530" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">It shouldn’t be too nested.</li><li id="eb3b" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">It should handle redundant and remove boilerplate code</li><li id="03bb" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">Easy to create abstraction.</li></ol><p id="8a97" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But how?</p><h1 id="1d24" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Developer-Centered Design</h1><p id="e93b" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">Do you know “User-Centered Design”? TLDR; It’s designed which revolved around user first.</p><p id="9626" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I really like the idea of the concept, so I just adapt the idea into improving the Developer Experience.</p><p id="cd4c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I have a job title as “Platform Architect” at work, it’s a fancy word for handling architecture for developers not limited to Infrastructure but rather the codebase itself.</p><p id="10f3" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">In fact, I work as a Frontend Platform Architect, which mainly helps developers with an architect of Monorepo Frontend and improves the developer experience.</p><p id="a08a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I investigate a way to improve DX, code quality, maintainability, investigate and design an approach for developers, or wrote an internal library to resolve redundant task if I have to.</p><p id="3d5b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Most of the tasks I accomplish are because I care about how developers approach a problem and how to handle them, it takes one to know one and to prevent them in the first place.</p><p id="1afc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">To resolve the problem correctly you have to clearly understand what problem they are facing correctly.</p><p id="6465" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I usually use the User-Centered Design approach but instead design code and approach for developers.</p></div><div class="o dz nj nk hr nl" role="separator"><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no"></span></div><div class="if ig ih ii ij"><p id="3464" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Back to Flutter.</p><p id="ca8e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">When you’re creating let's say, a Text.<br>You should be able to focus on a Text, not its parent.</p><p id="50ac" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Background, padding, border-radius is considered as property on many UI library and framework.<br>So let’s make it a property, so you can focus mainly on Text.</p><p id="80c9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You can think of this thing as props instead of a Widget.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft oc"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_ocKUbQV_ORKCYavzxeU4DQ.png" width="700" height="378" role="presentation"></div></div></figure><p id="a1ab" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now at the first glance, I know that this code creates a Text.<br>At least it’s easier to read than that nested syntax.</p><p id="6971" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But with this, it has a little problem.</p><blockquote class="ks"><p id="595f" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">What if I have to multiple layer of background color?</p></blockquote><p id="9fde" class="pw-post-body-paragraph ju jv im jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr if gn" data-selectable-paragraph="">This will not work with the current syntax, because the code doesn’t know which one to put a layer on.</p><p id="bccc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And seconds, Flutter’s property is usually nested even on the inside, looks at <strong class="jw in"><em class="od">“textStyle” </em></strong>property<em class="od">.<br></em>It takes another argument to handle styling, this is good for separating the styling type as a group and making it reusable in any other widget which also needs text styling.</p><p id="6cac" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">However, since it accepts an object, you have to declare an object first and sometimes you will need abstraction over an object to create a shortcut.</p><blockquote class="oe of og"><p id="5f30" class="ju jv od jw b jx jy jz ka kb kc kd ke oh kg kh ki oi kk kl km oj ko kp kq kr if gn" data-selectable-paragraph="">But what shortcut?</p></blockquote><p id="f226" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">In Flutter, an object property can hold many values, take Padding for example.</p><p id="731b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It mainly holds 4 values, padding of the 4 sides as a number.</p><p id="bf24" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">When you declare that you want all 4 sides to be the same value you use:</p><pre class="mx my mz na ge ok bt ol"><span id="66f7" class="gn om ld im on b do oo op l oq" data-selectable-paragraph="">padding: EdgeInsets.all(20)</span></pre><p id="fd0d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">When you want top-bottom and left-right to be the same, you can use:</p><pre class="mx my mz na ge ok bt ol"><span id="a630" class="gn om ld im on b do oo op l oq" data-selectable-paragraph="">padding: EdgeInsets.symmetric(<br>  horizontal: 24,<br>  vertical: 12,<br>)</span></pre><p id="f2d7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But notice that no matter what you do, the declaration of <code class="gm or os ot on b">EdgeInsets</code> is always required, even if we know that it’s padding.</p><p id="6053" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">SwiftUI solve this at the language itself auto infer property of the type that it accepts, which mean if this same syntax is implemented in SwiftUI it would be like</p><pre class="mx my mz na ge ok bt ol"><span id="4fa7" class="gn om ld im on b do oo op l oq" data-selectable-paragraph="">.padding(.horizontal, 24)<br>.padding(.vertical, 12)</span></pre><p id="9561" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">However, Dart doesn’t have this feature, so you have to declare EdgeInsets every time you pass it to padding.</p><p id="d345" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But what if we create a shorthand property to accept a just numbers and map itself to EdgeInsets?</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ou"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_wgtzfDgs11W6UjU8RhTKhg.png" width="700" height="582" role="presentation"></div></div></figure><p id="9332" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s much shorter and simple, the shorthand property <code class="gm or os ot on b">px, py</code> handles the task of creating EdgeInsets for us, so you don’t have to explicitly create one.</p><p id="4c74" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The name <code class="gm or os ot on b">px</code> , <code class="gm or os ot on b">py</code> is borrow from <code class="gm or os ot on b">TailwindCSS</code> naming convention, so if you’re a web developer you might be familiar with it.</p><p id="d55c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But now the question is still remains, how can I handle multiple layers of background Color and Padding?</p><p id="5649" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The answer and the approach is the one I have already shown you just a moment ago.</p><p id="7242" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Instead of providing it as a prop, let’s make it a <em class="od">chainable property</em> so we can tell which one comes first or last, better yet, we can provide a priority of overriding a value if needed.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_7RyJgADYzPTSLEkI4FixyQ.png" width="700" height="570" role="presentation"></div></div></figure><p id="93fb" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now I can handle the layering and priority of the styling.<br>The property will be as a Queue Stack.</p><p id="1860" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But what if I want to accept the parameter as an object of itself?</p><p id="2d99" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The good thing is, with these shorthand properties declared manually, I could name it as whatever I want or even shorten it down.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_RJ3vWD_Ekw2Nfrzn_C9Pzg.png" width="700" height="570" role="presentation"></div></div></figure><p id="bef2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Great, now I can do the same with property inside, I just have to create a class that inherits… oh you can’t directly do that in Dart if I happen to abstract over a widget like TextFormField.</p><p id="09e2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So I’ll just create a class that accepts the parameters like Text and returns the instance of Text instead.<br>With this, I could declare any property I want to store easily.</p><p id="b040" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Accepting some property as props starting to doesn’t make sense when shorthand property trying to achieve the same goal.</p><p id="14fa" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Let’s say I declare padding of all sides to 20 but then I want padding-top to be 40, how can I know which one to override which one?</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_7VhHKk0Jr20quk_-TIbOHw.png" width="700" height="447" role="presentation"></div></div></figure><p id="f227" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The answer is with parameters like this, you can’t assign priority property over one another.</p><p id="46cd" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So how?</p><h1 id="68b3" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Chain of priority</h1><p id="b2f9" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">So, why do you think SwiftUI uses changing the property to handle declaration for one that could be overridden?</p><p id="b92b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Why would CSS override property over one another?</p><p id="5925" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s the order of the property that gives it a priority to partly override the previous value.</p><p id="526a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">We can do the same thing in Dart with chain property like what we did with Padding and BackgroundColor.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_241uJSEQtvPy31XL7kZh_A.png" width="700" height="415" role="presentation"></div></div></figure><p id="99ee" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this, the property can entirely or partly rewrite itself based on the order of its call.</p><p id="b9e0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And to make sure that we don’t accidentally switch over to the parent stack, we could separate with a property that return the parent instance instead.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_Q50AC3pnJz4J-VX4ki5G8A.png" width="700" height="509" role="presentation"></div></div></figure><p id="1277" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">To make parent property accessible on every component, we can separate a parent builder to a different builder class then make a builder class that requires the parent builder to extends the class</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ow"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_TdjE7qCIrXBBjPTncB68Cw.png" width="700" height="290" role="presentation"></div></div></figure><p id="bb7a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this, we don't have to hold the parent property and rewrite the parent property for every builder class we might need.</p><p id="d788" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this concept, I wrote a library called Niku and create multiple building blocks for composing Flutter Widget.</p><p id="2308" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But for now, let just looks at how could I write a Flutter Widget using Niku.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ox"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_qfmoe7jlJHrGBQ2501xVgg.jpeg" width="700" height="700" role="presentation"></div></div></figure><p id="002a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You see that the code is really easy to understand at first glance.<br>It does solve the 4 principles I have for writing UI in Flutter.</p><p id="b11d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">However, this is not the end of the story, but rather a valuable lesson I learn from it.</p><h1 id="1933" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">The Side Effect Naive Abstraction</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft jj"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_8cRIf_-RG53w6Uc5nJwZVQ.jpeg" width="700" height="394" role="presentation"></div></div><figcaption class="nb bm fu fs ft nc nd bn b bo bp co" data-selectable-paragraph="">Hifumi</figcaption></figure><p id="5df5" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Although Niku does really solve the problem of developing Widget in Flutter for developers.<br>However, for a maintainer like me, the code is quite hard to maintain as a developer.</p><p id="5c5b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Since the way how I created Builder Widget, isn’t a true abstraction which means I have to declare <strong class="jw in">every possible properties </strong>of each builder widget including shorthand properties and even setter properties.</p><p id="567c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">For a small Widget like Text, I could create in less than 1,000 lines of code (including documentation) however things start to get complexes like the factory method of Button and adaptive property of switch and sliders can easily exceed 2,000–3,000 lines of code.</p><p id="6b94" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Not only that but the complex Widget like TextFormField which has over 200 properties including shorthand exceeds over 7,800 lines of code for a single widget.</p><p id="2dcc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Maintaining such a large amount of code can easily be prone to errors, luckily many developers who use Niku does helps submit Pull Requests fixing what I have been making mistake in.</p><p id="f9f1" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Not only with the problem of maintainability, but invoking 7,800 lines of code in a single Widget construction is not quite healthy for performance.</p><p id="73f9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Although Flutter did really well creating Niku Widget and can handle 60fps.<br>But for me, 7,800 loc is still too big to comprehend, so there’s a bit of performance tradeoff when using heavy animation.</p><p id="ba85" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And another problem is that without declaring widget property <code class="gm or os ot on b">final</code> you can’t declare the widget as a constant, which is a widget that won’t get rebuilt if the state changed.</p><p id="f8c2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now to list the problems, there are:</p><ol class=""><li id="2902" class="mf mg im jw b jx jy kb kc kf mh kj mi kn mj kr mk ml mm mn gn" data-selectable-paragraph="">Too many lines of code to maintain, how can I decouple some parts of code to be reused on other classes</li><li id="d5e8" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">Does it really require a custom setter to set the properties?</li><li id="d84d" class="mf mg im jw b jx mo kb mp kf mq kj mr kn ms kr mk ml mm mn gn" data-selectable-paragraph="">Is it possible to reuse properties across classes?</li></ol><p id="6b27" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With all these problems, I couldn’t happily maintain the project unless I find a way to fix them.</p><p id="3f1e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So I do read and research more about what could possibly go wrong and how could I implement it better for quite a long time.</p><h1 id="43b8" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">The Microservice of Object-Oriented</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft mw"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_ihy-gZnuHmu7Uy7aFxkfmQ.jpeg" width="700" height="394" role="presentation"></div></div></figure><p id="8f2b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">After a long search, I even read more concept about Object-Oriented even if I dislike it because many programming languages makes it looks too verbose (looking at you Java) and carefully read a list of Dart language feature that I could take benefits from.</p><p id="a0c9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Even though I dislike Dart because it’s mixed with Java and JavaScript but has verbose from the Java side, I find two features that really important for refactoring Niku.</p><p id="f2fb" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s named is extension and mixins.<br>Basically, <strong class="jw in">Dependency Injection</strong> in Dart.</p><p id="d3a8" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The extension allows you to define the class method without touching the main class.<br>You can create any method from the class and polymorph it if needed.</p><p id="ba8c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The real magic is with <strong class="jw in">Mixins </strong>which is a direct <strong class="jw in">Dependency Injection.<br></strong>Which you could also inject custom properties.</p><p id="240d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now, why <strong class="jw in">Dependency Injection </strong>is important?</p><p id="7263" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Because it allows you to decouple duplicated parts of classes into external code and then reuse any classes.</p><p id="2918" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This is different from inheritance because you could inject as many dependencies as you need and you can choose to not override it.<br>You can imagine it as a blueprint.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft oy"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_tbYS3tYcndJasJYfVrl8ZA.png" width="700" height="877" role="presentation"></div></div><figcaption class="nb bm fu fs ft nc nd bn b bo bp co" data-selectable-paragraph="">Mixins example</figcaption></figure><p id="8a7f" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Notice that I don’t declare any property in MyWidget class, but I could still somehow use the method and get the property?</p><p id="397d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this, I could decouple a large number of properties into separate mixins.</p><p id="c958" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Imagine `TextStyle` as an example, it roughly requires 300–400 lines of code to implement one in a widget, now I could take out that 300–400 lines of code out of every widget that uses TextStyle.</p><p id="22c6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The interesting thing is that, remember the ParentBuilder?<br>With mixins, I don’t need to declare and override a build method anymore, I could just store a widget as a getter then let the build function get the build widget then just return it.</p><p id="9d91" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But now I have a bit of a question.</p><blockquote class="oe of og"><p id="7d03" class="ju jv od jw b jx jy jz ka kb kc kd ke oh kg kh ki oi kk kl km oj ko kp kq kr if gn" data-selectable-paragraph="">Object or Mixins?</p></blockquote><p id="66db" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now that you see I can decouple both primitive type and non-primitive type like Object but should I really store Object as a Mixin?</p><p id="26ec" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You see, mixins are great for class abstraction but when you pass the object to the constructor, if you use the mixin, you have to flatten to properties in the constructor first before assigning them directly to a class property.</p><p id="2912" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Doing that defeats the purpose of mixins in the first place.</p><blockquote class="ks"><p id="d200" class="kt ku im bn kv kw kx ky kz la lb kr co" data-selectable-paragraph="">To decouple and reuse piece of code</p></blockquote><p id="9cc5" class="pw-post-body-paragraph ju jv im jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr if gn" data-selectable-paragraph="">If I use mixins to store complex Objects like TextStyle, then I will have to flatten them on every widget, even if I can create a helper method to help flatten it but that’s quite unnecessary compared to passing custom Object representation which stores the property and shortens property instead.</p><h1 id="b5f3" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Custom or Native Setter</h1><p id="20c3" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">Well, you see, previously on my first publish of Niku.</p><p id="6926" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I define a custom setter to parse a value before setting it to shorthand property.</p><p id="43a0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But that requires me to set up a custom setter for each and every property.</p><p id="0c19" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">As much I dislike Dart, there’s one specific feature I really like a lot.<br>Its name is “Cascade Notation”</p><p id="d755" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Basically, it allows you to set multiple properties at the same time, and we could use that in our code.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_-9j4lYvotRg7YANEpsb9zA.png" width="700" height="384" role="presentation"></div></div></figure><p id="9877" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This code allows us to set the value of color, font size, and font-weight at the same time without writing any setter.</p><p id="3615" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Because you could set the property of class by default.</p><p id="773f" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this Cascade Notation, I can finally drop setter to be able to chain property entirely for primitive types, and for non-primitive, since we’re using Custom Object to handle nested properties, we could also drop any nested properties setter in Widget.</p><p id="4b1d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">If we need a shorthand property setter we could just define a custom setter instead and decouple it to mixin so it could be reused on every class.</p><p id="9df1" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now with empty parameter mixins, I could use a little bit of a hack.</p><p id="1036" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You see, Dart getter cloud return void, and since getter is just an ordinary function, I could just declare a shortcut to assign properties to whatever I want without the need to pass parameters.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ov"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_v5QdKk62UTCyVuj65XTHHA.png" width="700" height="509" role="presentation"></div></div></figure><p id="1d22" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now there’s a little bit of a problem.</p><p id="c7f7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">In Dart, you couldn’t use cascade notation inside a cascade notation which means setting another class with cascade notation while setting another with the same method won’t work.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft oz"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_j2oEY7vpKcBjKUEfO7USPQ.png" width="700" height="456" role="presentation"></div></div></figure><p id="2a84" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Now working with this technical detail, we could prevent this by wrapping a parenthesis to explicitly declare which part to use cascade notation or…</p><h1 id="269f" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Reference Bridge</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft mw"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_B_eH_bnTC1kUFMLO8lSHkQ.jpeg" width="700" height="394" role="presentation"></div></div></figure><p id="fbb7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Let’s break from this problem for now with a new question.</p><p id="3456" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">If I’m using cascade notation, what would happen if I want to add a custom widget that Niku doesn’t offer?<br>Would I break from ParentBuilder and wrap a custom Widget then rewrap it with ParentBuilder again?</p><p id="9a7e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Pause, take a moment to think about it.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pa"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_5yOo_644usiL3G7JHnHTvg.png" width="700" height="530" role="presentation"></div></div></figure><p id="2d79" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">No, I won’t allow breaking, that defeats the purpose of ParentBuilder in the first place if I have to do that, but then how?</p><p id="b51a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Do you know how React Hook work?</p><p id="72e1" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s actually a function of getter, setter, notifier, and working together.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pb"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_KE67N-Qs7FLbVXr32VsWfA.png" width="700" height="247" role="presentation"></div></div></figure><p id="08e6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">See counter, what do you think it is?</p><p id="3ac7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Yes, the counter is actually a function that returns an inner value of the getter, the reason why it returns the value in Function Component is that React invokes the function call for you.</p><p id="bf84" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Every time the setter function is called, it updates the internal value then notify that React should re-render the component, then counter get the internal value as a reference return it has a value for you.</p><p id="5971" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">That’s also the reason why you can’t use hooks outside React component, because it require React environment to handle the getter for you.</p><p id="4882" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">We could use the same ideology from React and apply it to Niku here.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pc"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_ZfY3w75PXVFDo2Mf5Vn7Cw.png" width="700" height="613" role="presentation"></div></div></figure><p id="de5b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Setter in ParentBuilder is a bit special, it doesn’t actually store any property except a widget.</p><p id="cad9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Every time setter is called, it creates a widget then overrides property <code class="gm or os ot on b">widget</code> and adds previous property as a child of itself.</p><p id="ba57" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This means ParentBuilder doesn’t actually store a stack of properties or widgets, but just a single widget itself, dropping unnecessary memory to allocate multiple widget trees.</p><p id="0f9b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">When the function <code class="gm or os ot on b">useParent</code> is called, it takes a callback function which then passes the current reference of Widget itself then replaces the widget with the new instance of widget from the callback.</p><p id="6d30" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This could also apply to the complex object mechanism in <code class="gm or os ot on b">Text</code> the widget we discussed before.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pd"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_7PziynVFagjbWB37wE2Czg.png" width="700" height="700" role="presentation"></div></div></figure><p id="979f" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Not only that it can style complex objects, but it can also pass any value between builder and a value of class instance itself.</p><p id="ce68" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Just like a bridge.</p><h1 id="c152" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Code Separation</h1><p id="0853" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">The style builder works great, we could clearly see what we’re doing, which part we styling, and reducing boilerplate code.</p><p id="f5f4" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But how could we make it better?</p><p id="9d24" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Well, many frameworks encourage you to separate the structure and styling apart from each other and make it easy to reuse, eg. HTML&amp;CSS, React Native, Vuejs, Svelte.</p><p id="962e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Doing that, we could clearly see which part are we making the progress on, hence we could apply to style to any widget we want.</p><p id="ee09" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But how could we do it?</p></div><div class="o dz nj nk hr nl" role="separator"><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no np"></span><span class="nm gi cj nn no"></span></div><div class="if ig ih ii ij"><p id="12bd" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Remember that with our builder class store all of the properties required to create a widget we want?</p><p id="ba94" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Since we are holding the primitive value of it makes it null when we don’t actually set any.</p><p id="630f" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">We could easily reconcile any null property and set the value of the instance class we want.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pe"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_pQivdnhgmUxJv4L0IkV5qw.png" width="700" height="538" role="presentation"></div></div></figure><p id="3e2d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You can predefined Style somewhere like a StyleSheet then apply the style and let the reconciliation process just pick a non-null value and assign it to the current class.<br>This is somewhat equivalent to CSS class styling.</p><p id="4d51" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">These styles applying to the reconciliation process is passed as a reference, so memory allocation is only needed once declaring a style.</p><p id="7999" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s possible that you could just separate your entire styling using <code class="gm or os ot on b">apply</code> styling.</p><p id="e259" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And because it's a programming language, accepting parameters like CSS-in-JS is easy, since it is just a collection of functions you return widget from.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pf"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_nGDd8HowD1zB-gKlozofdw.png" width="700" height="430" role="presentation"></div></div></figure><p id="fc67" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Or even deriving a styling from another style is also possible.<br>Just make sure you take derivation as a value instead of a reference to prevent accidentally setting an original value.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pg"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_T_Gqc0y6YTrfBAD4jI-n2A.png" width="700" height="546" role="presentation"></div></div></figure><p id="2fbc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">With this, it opens the possibility to create an entire library CSS library like Bootstrap, Bulma, Tailwind CSS in Flutter.<br>You predefined a class then apply the style just like you would with CSS.</p><h1 id="b6c7" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Repaint Allocation</h1><p id="caa1" class="pw-post-body-paragraph ju jv im jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr if gn" data-selectable-paragraph="">To handle constant 60fps on mobile devices, the app has to be efficient enough.</p><p id="8852" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Niku is uncontactable because non of its field is final, but we can fix the problem by just letting it re-render every state change.</p><p id="685d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">To prevent unnecessary repaint, Niku can cache the dependencies need for updating the UI of the widget and prevent it from being re-render.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pc"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_-5EhhlEyXLBi-mNNKgewuA.png" width="700" height="579" role="presentation"></div></div></figure><p id="01f3" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This <code class="gm or os ot on b">.on</code> property, specified which value needs to be updated to perform a repaint.</p><p id="e55f" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Which basically check the dependencies every time it needs to be repainted and if the value is different, means that it should be repainted.<br>The code could easily simplified as below:</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft ph"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_9ICmJWL674kNDisHRWK5jw.png" width="700" height="630" role="presentation"></div></div></figure><p id="14c9" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The <code class="gm or os ot on b">.on</code> property is assigned to the extension of the ParentBuilder widget.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pi"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_V6U484sB8w6l1x_YIYx_6g.png" width="700" height="237" role="presentation"></div></div></figure><p id="38a5" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But this means that the <code class="gm or os ot on b">OnChange</code>is going to be invoked every time the state change and allocate some memory, but it will not be re-rendered.</p><p id="b32b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You can use the actual <code class="gm or os ot on b">OnChange</code> widget to prevent memory allocation, since the widget accepts the callback function which will be executed if repaint need, and that’s even it’s going allocate memory, but doing that will lose some Developer Experience of property builder, so the question is, should you?</p><h1 id="ac68" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Balancing Performance and Developer Experience</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft mw"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_sQRl01DwqNpt6lhatHYK7g.jpeg" width="700" height="394" role="presentation"></div></div></figure><p id="4b41" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">But why we would create all these solutions to just improve the developer experience? Why not just stick to native Flutter?</p><p id="a143" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Then I have a question to ask you.</p><p id="ddc6" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Why do we invent programming language when hand-tuned assembly turns out to have a better performance.</p><p id="c678" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Why do we invent Python and don’t just use C++ for everything because it’s clear that C++ is just so faster than Python?</p><p id="a960" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Why do we create GUI in the first place when the terminal is clearly used lesser resources.</p><p id="2f16" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Why do you use Flutter in the first place? When native mobile is clearly faster?</p><p id="608b" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">All of these have a reason, and clearly, performance is not the only thing that matters.</p><blockquote class="oe of og"><p id="c949" class="ju jv od jw b jx jy jz ka kb kc kd ke oh kg kh ki oi kk kl km oj ko kp kq kr if gn" data-selectable-paragraph="">Premature Optimization Is the Root of All Evil</p></blockquote><p id="7fb0" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">It’s fine to lower down performance by a bit but greatly increase developer experience and productivity.</p><p id="cad2" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Flutter is already fast and always has been.<br>Besides devices, these days could easily handle some more memory allocation and iteration and still be able to achieve 60fps easily.</p><p id="cfbd" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Wrapping <code class="gm or os ot on b">ChangeOn</code> on everything is fine on the surface, but the <code class="gm or os ot on b">ChangeOn</code> itself also allocate some memory and sacrifice some readability, most of the time the extension <code class="gm or os ot on b">.on</code> is just enough.</p><p id="4f1a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">You should use <code class="gm or os ot on b">ChangeOn</code> on heavy tasks like intense animation re-rendering on 120fps devices, that’s a great case where you want to sacrifice some readability for performance.</p><p id="4bae" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So back to the question to while use Niku or even create Niku in the first place?</p><p id="231c" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I didn’t create Niku to increase the performance of the Flutter app, if it actually does then that’s the side effect of it.</p><p id="2c22" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I create Niku because as much as I love optimization and cursing most apps are created with Electron which has a million-dollar company as a back, I believe Developer Experience is also an important factor to consider.</p><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft pj"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_SLYSMvBRWYg2iXCsYuJx7A.jpeg" width="700" height="689" role="presentation"></div></div><figcaption class="nb bm fu fs ft nc nd bn b bo bp co" data-selectable-paragraph="">Which one are you going to use</figcaption></figure><p id="0067" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">So matter how great an app performance is if nobody wants to develop that app anymore then it wouldn’t be anything to develop and nobody is going to use it anymore.</p><h1 id="a6ec" class="lc ld im bn le lf lg lh li lj lk ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz gn" data-selectable-paragraph="">Afterword</h1><figure class="mx my mz na ge jn fs ft paragraph-image"><div role="button" tabindex="0" class="jo jp dq jq cf jr"><div class="fs ft mw"><img alt="" class="cf js jt" src="./niku-thought-process-of-designing-a-balance-framework/1_ihy-gZnuHmu7Uy7aFxkfmQ.jpeg" width="700" height="394" role="presentation"></div></div></figure><p id="e014" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">This article/blog explains the thought process and design decision while creating a Flutter library for composing UI named, “Niku”.</p><p id="2ce7" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">I didn’t write this article to promote the library, Niku 2, or the thought process of the article hasn’t had a stable release yet, I find the thought process behind it interesting and valuable, so it would be great to share.</p><p id="267a" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The thought behind creating a balanced framework especially in a declarative environment that has a lot of edge cases is hard and most likely going to fail at some point, but you can use the mistake you made to improve yourself.</p><p id="4260" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">And at some point where you feel like achieving something, you could always share it with someone and help them get better from your experience and mistake.</p><p id="f873" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">The concept of this article has been used internally, but still in progress of work as Niku 2 on Github as an Opensource on the branch <code class="gm or os ot on b">exp/heaven-and-earth</code> , in case you want to check it out.</p><div class="pk pl ga gc pm pn"><a href="https://github.com/saltyaom/niku/tree/exp/heaven-and-earth" rel="noopener  ugc nofollow" target="_blank"><div class="po o hm"><div class="pp o db dz ep pq"><h2 class="bn in do bp pr ps pt pu pv pw px il gn">GitHub - SaltyAom/niku at exp/heaven-and-earth</h2><div class="py l"><h3 class="bn b do bp pr ps pt pu pv pw px co">Effortless property builder for composing maintainable Flutter UI Creating UI in Flutter is easy. Its declarative…</h3></div><div class="pz l"><p class="bn b gv bp pr ps pt pu pv pw px co">github.com</p></div></div><div class="qa l"><div class="qb l qc qd qe qa qf js pn"></div></div></div></a></div><p id="bfdc" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Note that by the time of article release, it doesn’t have any documentation yet.</p><p id="bb5d" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Also, the image used in this article is from a game called, <a class="au qg" href="https://bluearchive.jp/" rel="noopener ugc nofollow" target="_blank">“Blue Archive”</a>, every image is used from the <a class="au qg" href="https://youtu.be/Chh_rhWqvAA" rel="noopener ugc nofollow" target="_blank">2nd PV of the game</a>, in case you might want to check it out.<br>I’m actually planning on cosplaying some characters from there too.</p><p id="ec8e" class="pw-post-body-paragraph ju jv im jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr if gn" data-selectable-paragraph="">Happy coding~ \( ﾟヮﾟ)/</p></div></div></section>
        </article>
      </div>
    </div>
</body></html>

<script type="text/javascript" src="./niku-thought-process-of-designing-a-balance-framework/imagesloaded.pkgd.min.js"></script>

